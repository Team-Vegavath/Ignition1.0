<!DOCTYPE html>
<html>
<head>
    <title>GPS Server for Rider Telemetry</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #111;
            color: #fff;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: #1f2937;
        }
        .connected { background: #065f46; }
        .error { background: #7f1d1d; }
        .data {
            font-family: monospace;
            background: #000;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üì° GPS Server for Rider Telemetry</h1>
    <div id="status" class="status">Waiting for GPS...</div>
    <div id="data" class="data">No data yet</div>
    <div id="info">Server running. Share this phone's IP address.</div>

    <script>
        let gpsData = null;
        let watchId = null;

        // Get GPS location every second
        function startGPS() {
            if (navigator.geolocation) {
                watchId = navigator.geolocation.watchPosition(
                    (position) => {
                        gpsData = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            speed: (position.coords.speed || 0) * 3.6 // Convert m/s to km/h
                        };
                        
                        document.getElementById('status').textContent = '‚úÖ GPS Connected';
                        document.getElementById('status').className = 'status connected';
                        document.getElementById('data').textContent = JSON.stringify(gpsData, null, 2);
                    },
                    (error) => {
                        document.getElementById('status').textContent = '‚ùå GPS Error: ' + error.message;
                        document.getElementById('status').className = 'status error';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000,
                        maximumAge: 0
                    }
                );
            } else {
                document.getElementById('status').textContent = '‚ùå Geolocation not supported';
                document.getElementById('status').className = 'status error';
            }
        }

        // Simple HTTP server using Service Worker or fetch API
        // For hackathon: Use a simple Node.js server instead (see instructions)
        
        // Get current IP address
        async function getIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                document.getElementById('info').innerHTML = 
                    `Your IP: <strong>${data.ip}</strong><br>` +
                    `Local IP: Check WiFi settings<br>` +
                    `API Endpoint: http://YOUR_LOCAL_IP:8080/gps`;
            } catch (e) {
                document.getElementById('info').innerHTML = 
                    'Check WiFi settings for local IP address';
            }
        }

        startGPS();
        getIP();
    </script>
</body>
</html>

